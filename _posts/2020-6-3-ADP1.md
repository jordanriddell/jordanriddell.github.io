---
layout: post
title: Twitter Data
---

This post will detail how to use a windows command prompts and Python to scrape Twitter data for a single user account and then explain how to organize and visualize retweet and favorite data for three different types of Dallas Police Department tweets. The following steps explain how to download tweets from the Dallas Police Department Twitter account.



First, make sure to have at least Python 3 on your computer. Next, you will need to have pip installed on your pc. Once those are both completed, go to [Nickersen Weng's github](https://github.com/NicksonWeng/Get-Old-Tweet-Modified) and download the files from the repository to a folder of your choice. Just remember where you save and extract them because you will need to set the path directory to the same folder as those files later on.

Using the Windows command prompt (just type cmd in the search bar on the bottom left), enter the following commands in sequence.

#Any line with # is comment, rest is entered at end of directory and after the >
#first, make sure pip has been installed on your device

#check to make sure you have python
python

#exit python environment
exit()

#set working directory to the Twitterdata folder that you have the unzipped files in
cd Dropbox\Twitterdata

#install GetOldTweets3
python -m pip install GetOldTweets3

#execute Twitter search and download - multiple options
#keyword search example: python Exporter.py --querysearch "Keyword Here" --since YEAR-MM-DD --until YEAR-MM-DD --maxtweets XXX --output filename.csv
#notes: keyword may be case sensitive; since = start date; until = end date
#username search: python Exporter.py --username "username" --since YEAR-MM-DD --until YEAR-MM-DD --maxtweets XXX --output filename.csv
#notes: username may be case sensitive and should include all characters after the @; since = start date; until = end date

#I used the following command to download all tweets from the Dallas Police Department's Twitter account. Note: if you do not want all tweets, restrict the date or set a maxtweet limit.
python Exporter.py --username "DallasPD" --since 2009-04-01 --until 2020-06-06 --output dpd_tweets.csv

#What happened to me during this process is that it stopped at 2014-10-31, so I had one .csv file with all DPD tweets from 10/31/2014 - 6/5/2020, so I had to run the following command in the Windows command prompt
python Exporter.py --username "DallasPD" --since 2009-04-01 --until 2014-10-31 --output dpd_tweets1.csv

After that is done, you can exit the Windows command prompt. Next, open up R or RStudio to 1) manage the data and 2) visualize retweet and favorite densities for DPD tweets about missing persons, homicides, and protests.


rm(list=ls())
setwd("C:/Users/jorda/Dropbox/PHDWork/Summer2020/EPPS7v81_DataScience/Exercise1")

#load packages
library(data.table)

#load downloaded .csv files and append them to one another
file1 <- read.csv(file="dpdtweets.csv", header=T, sep=";")
file2 <- read.csv(file="dpdtweets1.csv", header=T, sep=";")
dpdtweets <- rbind(file1,file2)

#create indicators for when they tweet about someone that is missing, a homicide, or a protest
#missing - "missing" "missing person" 
missingmatch <- c("missing", "missing person", "missing persons")

#homicide - "homicide" "murder" 
homicidematch <- c("homicide", "murder", "homicides", "killing", "killings")

#protest - "protest" "protesters" 
protestmatch <- c("protest", "protesters", "Protest", "Protest")

dpdtweets$missingperson <- grepl(paste(missingmatch,collapse="|"), dpdtweets$text, ignore.case = TRUE)
dpdtweets$homicide <- grepl(paste(homicidematch,collapse="|"), dpdtweets$text, ignore.case = TRUE)
dpdtweets$protest <- grepl(paste(protestmatch,collapse="|"), dpdtweets$text, ignore.case = TRUE)

#apply numeric indicators to T/F logic indicators - does so for every boolean column in the data.frame
Cols <-  which(sapply(dpdtweets, is.logical))
setDT(dpdtweets)
for(j in Cols){
  set(dpdtweets, i=NULL, j=j, value= as.numeric(dpdtweets[[j]]))
}

#see how many of each kind of tweet there are
table(dpdtweets$missingperson)
table(dpdtweets$homicide)
table(dpdtweets$protest)

#convert retweet and favorite data from character to numeric
dpdtweets$retweets <- as.numeric(dpdtweets$retweets)
dpdtweets$favorites <- as.numeric(dpdtweets$favorites)

#subset data by removing the select few observations that are clearly messed up (way too high retweet/favorite count - DPD isn't that popular)
dpdtweet <- subset(dpdtweets, dpdtweets$retweets < 100000 | dpdtweets$favorites <100000)

#create objects with subsets of data for each type of tweet; recall 1=presence of keywords & 0=absence
missing <- subset(dpdtweet, dpdtweet$missingperson > 0)
homicide <- subset(dpdtweet, dpdtweet$homicide > 0)
protest <- subset(dpdtweet, dpdtweet$protest > 0)

#check to see new summary statistics
summary(dpdtweet$retweets)
summary(dpdtweet$favorites)

summary(missing$retweets)
summary(missing$favorites)

summary(homicide$retweets)
summary(homicide$favorites)

summary(protest$retweets)
summary(protest$favorites)

#plot retweet vs favorite plots for the missing, homicides, protests;
png(file="missing.png", width=12, height=8, units="in", res=300)
plot(missing$retweets, missing$favorites, main="Favorites by Retweets; DPD Missing Persons Tweets", xlab="Retweets", ylab="Favorites", cex.main=2, cex.lab=1.5, cex.axis=1.5)
dev.off()

png(file="homicide.png", width=12, height=8, units="in", res=300)
plot(homicide$retweets, homicide$favorites, main="Favorites by Retweets; DPD Homicide Tweets", xlab="Retweets", ylab="Favorites", cex.main=2, cex.lab=1.5, cex.axis=1.5)
dev.off()

png(file="protest.png", width=12, height=8, units="in", res=300)
plot(protest$retweets, protest$favorites, main="Favorites by Retweets; DPD Protest Tweets", xlab="Retweets", ylab="Favorites", cex.main=2, cex.lab=1.5, cex.axis=1.5)
dev.off

#you can also loot at the plots by scaling retweets and favorites per tweet
plot(missing$retweets/length(missing$retweets), missing$favorites/length(missing$favorites), main="Favorites by Retweets; DPD Missing Persons Tweets", xlab="Retweets", ylab="Favorites")
plot(homicide$retweets/length(homicide$retweets), homicide$favorites/length(homicide$favorites), main="Favorites by Retweets; DPD Homicide Tweets", xlab="Retweets", ylab="Favorites")
plot(protest$retweets/length(protest$retweets), protest$favorites/length(protest$favorites), main="Favorites by Retweets; DPD Protest Tweets", xlab="Retweets", ylab="Favorites")

#density plots of retweets and favorites
png(file="retweet_DPD.png", width=12, height=8, units="in", res=300)
plot(density(homicide$retweets), type="l", col="blue", pch="o", lty=1, lwd=2, main="Retweet Density for Dallas Police Department Tweets", xlim=c(0,500), xlab="Retweets", ylab="Retweet Density", cex.main=2, cex.lab=1.5, cex.axis=1.5)
par(new=T)
lines(density(missing$retweets), type="l", col="black", pch="o", lty=1, lwd=2, main=NA, xlim=c(0,500), xlab=NA, ylab=NA)
par(new=T)
lines(density(protest$retweets), type="l", col="red", pch="o", lty=1, lwd=2, main=NA, xlim=c(0,500), xlab=NA, ylab=NA)
par(xpd=T)
legend("topright",
       legend=c("Missing Persons", "Homicide", "Protesting"),
       lty=c(1,1,1), lwd=c(2,2,2), col=c("black", "blue", "red"), xpd=T, cex=1.5)
dev.off()

png(file="favorites_DPD.png", width=12, height=8, units="in", res=300)
plot(density(homicide$favorites), type="l", col="blue", pch="o", lty=1, lwd=2, main="Favorite Density for Dallas Police Department Tweets", xlim=c(0,500), xlab="Favorites", ylab="Favorite Density", cex.main=2, cex.lab=1.5, cex.axis=1.5)
par(new=T)
lines(density(missing$favorites), type="l", col="black", pch="o", lty=1, lwd=2, main=NA, xlim=c(0,500), xlab=NA, ylab=NA)
par(new=T)
lines(density(protest$favorites), type="l", col="red", pch="o", lty=1, lwd=2, main=NA, xlim=c(0,500), xlab=NA, ylab=NA)
par(xpd=T)
legend("topright",
       legend=c("Missing Persons", "Homicide", "Protesting"),
       lty=c(1,1,1), lwd=c(2,2,2), col=c("black", "blue", "red"), xpd=T, cex=1.5)
dev.off()





What we end up with are density plots of retweet and favorite data. The following images display density plots for retweets and favorites

![Imgur](https://i.imgur.com/2vaQ6nK.png)


![Imgur](https://i.imgur.com/Rcxz3eE.png)

